<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>VALONDE</title>
    <script src="http://s.codepen.io/assets/libs/modernizr.js" type="text/javascript"></script>
    <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Oswald:400'>
    <style>
    .world,.world-bg,body,html{width:100%;height:100%}.info,body,html{position:absolute;color:#fff}body,html{margin:0;overflow:hidden;font-family:Lato,sans-serif;background-color:#000}.world{position:absolute;cursor:pointer;cursor:move;cursor:-moz-grab;cursor:-webkit-grab;cursor:grab}.world-bg{position:absolute;background-position:50% 50%;background-size:cover}.world-globe{position:absolute;left:50%;top:50%;width:0;height:0}.world-globe-pole{position:absolute;width:530px;height:530px;left:-265px;top:-265px;border-radius:50%;background-color:#fff}.world-globe-doms-container{position:absolute;left:50%;top:50%;width:0;height:0}.world-globe-halo{position:absolute;left:50%;top:50%;width:730px;height:715px;margin-left:-368px;margin-top:-350px}.info{left:0;bottom:0;width:100%;padding:10px;box-sizing:border-box;background-color:rgba(0,0,0,.8);font-size:12px}.info-desc{color:#ddd;font-size:10px}a{color:#ff5f5f}
    </style>
    <script src="//assets.codepen.io/assets/libs/prefixfree.min-de773054e90c52a3c2631c944681b64e.js"></script>
  </head>
  <body>
    <div class="world">
      <div class="world-bg"></div>
      <div class="world-globe">
        <div class="world-globe-pole"></div>
        <div class="world-globe-doms-container"></div>
        <div class="world-globe-halo"></div>
      </div>
    </div>
    <script src='//cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js'></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/stats.js/r11/Stats.js'></script>
    <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/6043/css_globe_PerspectiveTransform.js'></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/gsap/1.16.1/TweenMax.min.js'></script>
    
    <script>
    function init(){world=document.querySelector(".world"),worldBg=document.querySelector(".world-bg"),worldBg.style.backgroundImage="url("+URLS.bg+")",globe=document.querySelector(".world-globe"),globeContainer=document.querySelector(".world-globe-doms-container"),globePole=document.querySelector(".world-globe-pole"),globeHalo=document.querySelector(".world-globe-halo"),globeHalo.style.backgroundImage="url("+URLS.halo+")",regenerateGlobe();var o=new dat.GUI;o.add(config,"lat",-90,90).listen(),o.add(config,"lng",-180,180).listen(),o.add(config,"isHaloVisible"),o.add(config,"isPoleVisible"),o.add(config,"autoSpin"),o.add(config,"goToBristol"),o.add(config,"zoom",0,1).listen(),stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.left=0,stats.domElement.style.top=0,document.body.appendChild(stats.domElement),world.ondragstart=function(){return!1},world.addEventListener("mousedown",onMouseDown),world.addEventListener("mousemove",onMouseMove),world.addEventListener("mouseup",onMouseUp),world.addEventListener("touchstart",touchPass(onMouseDown)),world.addEventListener("touchmove",touchPass(onMouseMove)),world.addEventListener("touchend",touchPass(onMouseUp)),loop()}function touchPass(o){return function(e){e.preventDefault(),o.call(this,{pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY})}}function onMouseDown(o){isMouseDown=!0,dragX=o.pageX,dragY=o.pageY,dragLat=config.lat,dragLng=config.lng}function onMouseMove(o){if(isMouseDown){var e=o.pageX-dragX,t=o.pageY-dragY;config.lat=clamp(dragLat+.5*t,-90,90),config.lng=clampLng(dragLng-.5*e,-180,180)}}function onMouseUp(){isMouseDown&&(isMouseDown=!1)}function regenerateGlobe(){var o,e,t,n;for(globeDoms=[];o=globeContainer.firstChild;)globeContainer.removeChild(o);var s=config.segX,a=config.segY,r="url("+URLS.diffuse+")",i=1600/s|0,l=800/a|0;vertices=[];var g,c=268,d=0,p=2*Math.PI,f=0,u=Math.PI;for(n=0;a>=n;n++){for(g=[],t=0;s>=t;t++){var m=t/s,h=.05+n/a*.9,b={x:-c*Math.cos(d+m*p)*Math.sin(f+h*u),y:-c*Math.cos(f+h*u),z:c*Math.sin(d+m*p)*Math.sin(f+h*u),phi:d+m*p,theta:f+h*u};g.push(b)}vertices.push(g)}for(n=0;a>n;++n)for(t=0;s>t;++t)o=document.createElement("div"),e=o.style,e.position="absolute",e.width=i+"px",e.height=l+"px",e.overflow="hidden",e[PerspectiveTransform.transformOriginStyleName]="0 0",e.backgroundImage=r,o.perspectiveTransform=new PerspectiveTransform(o,i,l),o.topLeft=vertices[n][t],o.topRight=vertices[n][t+1],o.bottomLeft=vertices[n+1][t],o.bottomRight=vertices[n+1][t+1],e.backgroundPosition=-i*t+"px "+-l*n+"px",globeContainer.appendChild(o),globeDoms.push(o)}function loop(){requestAnimationFrame(loop),stats.begin(),render(),stats.end()}function render(){!config.autoSpin||isMouseDown||isTweening||(config.lng=clampLng(config.lng-.2)),rX=config.lat/180*Math.PI,rY=(clampLng(config.lng)-270)/180*Math.PI,globePole.style.display=config.isPoleVisible?"block":"none",globeHalo.style.display=config.isHaloVisible?"block":"none";var o=Math.pow(config.zoom,1.5);pixelExpandOffset=1.5+-1.25*o,o=1+3*o,globe.style[transformStyleName]="scale3d("+o+","+o+",1)",o=1+.3*Math.pow(config.zoom,3),worldBg.style[transformStyleName]="scale3d("+o+","+o+",1)",transformGlobe()}function clamp(o,e,t){return e>o?e:o>t?t:o}function clampLng(o){return(o+180)%360-180}function transformGlobe(){var o,e,t,n,s,a,r,i,l,g,c,d;if(tick^=1){sinRY=Math.sin(rY),sinRX=Math.sin(-rX),sinRZ=Math.sin(rZ),cosRY=Math.cos(rY),cosRX=Math.cos(-rX),cosRZ=Math.cos(rZ);var p=config.segX,f=config.segY;for(n=0;f>=n;n++)for(g=vertices[n],t=0;p>=t;t++)rotate(l=g[t],l.x,l.y,l.z);for(n=0;f>n;n++)for(t=0;p>t;t++)o=globeDoms[t+p*n],s=o.topLeft,a=o.topRight,r=o.bottomLeft,i=o.bottomRight,expand(s,a),expand(a,r),expand(r,i),expand(i,s),e=o.perspectiveTransform,e.topLeft.x=s.tx,e.topLeft.y=s.ty,e.topRight.x=a.tx,e.topRight.y=a.ty,e.bottomLeft.x=r.tx,e.bottomLeft.y=r.ty,e.bottomRight.x=i.tx,e.bottomRight.y=i.ty,e.hasError=e.checkError(),(e.hasError=e.checkError())||e.calc()}else for(c=0,d=globeDoms.length;d>c;c++)e=globeDoms[c].perspectiveTransform,e.hasError?e.style[transformStyleName]="translate3d(-8192px, 0, 0)":e.update()}function goTo(o,e){var t=o-config.lat,n=e-config.lng,s=Math.sqrt(t*t+n*n);isTweening=!0,TweenMax.to(config,.01*s,{lat:o,lng:e,ease:"easeInOutSine"}),TweenMax.to(config,1,{delay:.01*s,zoom:1,ease:"easeInOutSine",onComplete:function(){isTweening=!1}})}function rotate(o,e,t,n){x0=e*cosRY-n*sinRY,z0=n*cosRY+e*sinRY,y0=t*cosRX-z0*sinRX,z0=z0*cosRX+t*sinRX;var s=1+z0/4e3;x1=x0*cosRZ-y0*sinRZ,y0=y0*cosRZ+x0*sinRZ,o.px=x1*s,o.py=y0*s}function expand(o,e){var t,n=e.px-o.px,s=e.py-o.py,a=n*n+s*s;return 0===a?(o.tx=o.px,o.ty=o.py,e.tx=e.px,void(e.ty=e.py)):(t=pixelExpandOffset/Math.sqrt(a),n*=t,s*=t,e.tx=e.px+n,e.ty=e.py+s,o.tx=o.px-n,void(o.ty=o.py-s))}var config={percent:0,lat:0,lng:0,segX:14,segY:12,isHaloVisible:!0,isPoleVisible:!0,autoSpin:!0,zoom:0,skipPreloaderAnimation:!1,goToBristol:function(){goTo(51.45,2.5833)}},stats,imgs,preloader,preloadPercent,globeDoms,vertices,world,worldBg,globe,globeContainer,globePole,globeHalo,pixelExpandOffset=1.5,rX=0,rY=0,rZ=0,sinRX,sinRY,sinRZ,cosRX,cosRY,cosRZ,dragX,dragY,dragLat,dragLng,isMouseDown=!1,isTweening=!1,tick=1,URLS={bg:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/6043/css_globe_bg.jpg",diffuse:"http://localhost/dakota.jpg",halo:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/6043/css_globe_halo.png"},transformStyleName=PerspectiveTransform.transformStyleName;init();
    </script>
    
    <script>
    if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
    }
    </script>    
  </body>
</html>
